{"version":3,"sources":["../../src/op-sqlite/driver.ts"],"sourcesContent":["import type { OPSQLiteConnection, QueryResult } from '@op-engineering/op-sqlite';\nimport { DefaultLogger } from '~/logger.ts';\nimport {\n    createTableRelationsHelpers,\n    extractTablesRelationalConfig,\n    type RelationalSchemaConfig,\n    type TablesRelationalConfig,\n} from '~/relations.ts';\nimport { BaseSQLiteDatabase } from '~/sqlite-core/db.ts';\nimport { SQLiteAsyncDialect } from '~/sqlite-core/dialect.ts';\nimport type { DrizzleConfig } from '~/utils.ts';\nimport { OPSQLiteSession } from './session.ts';\n\nexport type OPSQLiteDatabase<\n    TSchema extends Record<string, unknown> = Record<string, never>,\n> = BaseSQLiteDatabase<'async', QueryResult, TSchema>;\n\nexport function drizzle<TSchema extends Record<string, unknown> = Record<string, never>>(\n    client: OPSQLiteConnection,\n    config: DrizzleConfig<TSchema> = {},\n): OPSQLiteDatabase<TSchema> {\n    const dialect = new SQLiteAsyncDialect();\n    let logger;\n    if (config.logger === true) {\n        logger = new DefaultLogger();\n    } else if (config.logger !== false) {\n        logger = config.logger;\n    }\n\n    let schema: RelationalSchemaConfig<TablesRelationalConfig> | undefined;\n    if (config.schema) {\n        const tablesConfig = extractTablesRelationalConfig(\n            config.schema,\n            createTableRelationsHelpers,\n        );\n        schema = {\n            fullSchema: config.schema,\n            schema: tablesConfig.tables,\n            tableNamesMap: tablesConfig.tableNamesMap,\n        };\n    }\n\n    const session = new OPSQLiteSession(client, dialect, schema, { logger });\n    return new BaseSQLiteDatabase('async', dialect, session, schema) as OPSQLiteDatabase<TSchema>;\n}"],"mappings":";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA,oBAA8B;AAC9B,uBAKO;AACP,gBAAmC;AACnC,qBAAmC;AAEnC,qBAAgC;AAMzB,SAAS,QACZ,QACA,SAAiC,CAAC,GACT;AACzB,QAAM,UAAU,IAAI,kCAAmB;AACvC,MAAI;AACJ,MAAI,OAAO,WAAW,MAAM;AACxB,aAAS,IAAI,4BAAc;AAAA,EAC/B,WAAW,OAAO,WAAW,OAAO;AAChC,aAAS,OAAO;AAAA,EACpB;AAEA,MAAI;AACJ,MAAI,OAAO,QAAQ;AACf,UAAM,mBAAe;AAAA,MACjB,OAAO;AAAA,MACP;AAAA,IACJ;AACA,aAAS;AAAA,MACL,YAAY,OAAO;AAAA,MACnB,QAAQ,aAAa;AAAA,MACrB,eAAe,aAAa;AAAA,IAChC;AAAA,EACJ;AAEA,QAAM,UAAU,IAAI,+BAAgB,QAAQ,SAAS,QAAQ,EAAE,OAAO,CAAC;AACvE,SAAO,IAAI,6BAAmB,SAAS,SAAS,SAAS,MAAM;AACnE;","names":[]}